#
# Example configuration file for the StorageHub MSP Backend service.
# Copy or adapt this file when running the backend locally or in a deployment.
#

# Server configuration
# The host address to bind the HTTP server to
host = "127.0.0.1"
# The port to bind the HTTP server to (default: 8080)
port = 8080
# Log format (text, json, or auto-detect)
log_format = "auto"

# API configuration for pagination and request handling
[api]
# Default number of items per page in paginated API responses (default: 20)
# This value is used when clients don't specify a limit
default_page_size = 20
# Maximum allowed page size for paginated API responses (default: 100)
# Requests exceeding this limit will be capped to this value
max_page_size = 100

# Authentication configuration
[auth]
# JWT secret key for signing and verifying tokens (required)
# Must be at least 32 bytes (64 hex characters) for HS256 algorithm
# Can also be set via JWT_SECRET environment variable (takes precedence)
jwt_secret = "0xdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef"
# JWT token expiration time in minutes (default: 300 = 5 hours)
# This determines how long a user session remains valid
session_expiration_minutes = 300
# Authentication nonce expiration time in seconds (default: 300 = 5 minutes)
# This determines how long a user has to complete the authentication flow
nonce_expiration_seconds = 300
# SIWE (Sign-In with Ethereum) domain used in authentication messages
# Should match the domain where this backend is accessible (default: "localhost")
siwe_domain = "localhost"

# StorageHub RPC configuration
[storage_hub]
# WebSocket RPC endpoint for the StorageHub node
# Use ws:// for unencrypted or wss:// for TLS-encrypted connections
rpc_url = "ws://localhost:9944"
# Request timeout in seconds (optional, default: 30)
# Increase this value for slower networks or heavy operations
timeout_secs = 30
# Maximum concurrent RPC requests (optional, default: 100)
# Adjust based on your node's capacity and network conditions
max_concurrent_requests = 100
# Whether to verify TLS certificates when using wss:// connections
# Set to false only for development environments with self-signed certificates
verify_tls = true
# Enable mock mode for testing (requires 'mocks' feature to be enabled at compile time)
# When true, uses mock RPC connections instead of real network calls
# mock_mode = false

# MSP-specific configuration
[msp]
# URL for node to communicate with the backend (e.g for uploading a file)
# e.g: if running an msp in a container: http://host.docker.internal:8080
callback_url = "http://localhost:8080"
# URL for the MSP trusted file transfer server
# This is the endpoint where file uploads will be sent
trusted_file_transfer_server_url = "http://localhost:7070"
# Number of retry attempts for file upload operations (default: 3)
# Increase for unreliable network conditions
upload_retry_attempts = 3
# Delay in seconds between file upload retry attempts (default: 1)
upload_retry_delay_secs = 1
# Use legacy RPC-based upload method instead of trusted file transfer server (default: false)
# When true, file chunks (and proofs) are sent via the receiveBackendFileChunks RPC endpoint
use_legacy_upload_method = false

# Database configuration
[database]
# PostgreSQL connection URL
# Format: postgresql://[user[:password]@][host][:port][/database]
# Example for Docker environment: postgresql://postgres:postgres@docker-sh-indexer-postgres-1:5432/storage_hub
url = "postgresql://postgres:postgres@localhost:5432/storage_hub"
# Enable mock mode for testing (requires 'mocks' feature to be enabled at compile time)
# When true, uses in-memory mock database instead of real PostgreSQL connection
# mock_mode = false

# File transfer session management
[file_transfer]
# Maximum number of concurrent file uploads allowed (default: 100)
# Prevents concurrent uploads of the same file key
# Adjust based on your server's capacity and expected load
max_upload_sessions = 100
# Maximum number of concurrent file downloads allowed (default: 100)
# Adjust based on your server's bandwidth and memory capacity
max_download_sessions = 100
